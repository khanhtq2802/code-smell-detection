{"text": "<fim_prefix>      {\n        org.w3c.dom.Element elem = e.lookupFaultDetail(new javax.xml.namespace.QName(\"http://xml.apache.org/axis/\",\"HttpErrorCode\"));\n        if (elem != null)\n        {\n          elem.normalize();\n          String httpErrorCode = elem.getFirstChild().getNodeValue().trim();\n          // 302 is what SharePoint returns for external sites\n          if (httpErrorCode.equals(\"404\") || httpErrorCode.equals(\"302\"))\n            return null;\n          else if (httpErrorCode.equals(\"403\"))\n            throw new ManifoldCFException(\"Remote procedure exception: \"+e.getMessage(),e);\n          else if (httpErrorCode.equals(\"401\"))\n          {\n            if (Logging.connectors.isDebugEnabled())\n              Logging.connectors.debug(\"SharePoint: Crawl user does not have sufficient privileges to read lists for site \"+parentSite+\" - skipping\",e);\n            return null;\n          }\n          throw new ManifoldCFException(\"Unexpected http error code \"+httpErrorCode+\" accessing SharePoint at \"+baseUrl+parentSite+\": \"+e.getMessage(),e);\n        }\n        throw new ManifoldCFException(\"Unknown http error occurred: \"+e.getMessage(),e);\n      }\n      if (e.getFaultCode().equals(new javax.xml.namespace.QName(\"http://schemas.xmlsoap.org/soap/envelope/\",\"Server.userException\")))\n      {\n        String exceptionName = e.getFaultString();\n        if (exceptionName.equals(\"java.lang.InterruptedException\"))\n          throw new ManifoldCFException(\"Interrupted\",ManifoldCFException.INTERRUPTED);\n      }\n      if (Logging.connectors.isDebugEnabled())\n        Logging.connectors.debug(\"SharePoint: Got a remote exception reading lists for site \"+parentSite+\" - retrying\",e);\n      currentTime = System.currentTimeMillis();\n      throw new ServiceInterruption(\"Remote procedure exception: \"+e.getMessage(), e, currentTime + 300000L,\n        currentTime + 3 * 60 * 60000L,-1,false);\n    }\n    catch (java.rmi.RemoteException e)\n    {\n      throw new ManifoldCFException(\"Unexpected remote exception occurred: \"+e.getMessage(),e);\n    }\n  }\n  // Regexp pattern to match 12345;#\n  protected static Pattern subsPattern;\n  static\n  {\n    try\n    {\n      subsPattern = Pattern.compile(\"[0-9]*;#.*\");\n    }\n    catch (Exception e)\n    {\n      e.printStackTrace();\n      System.exit(-100);\n    }\n  }\n  /** Substitute progid where found */\n  protected static String valueMunge(String value)\n  {\n    Matcher matcher = subsPattern.matcher(value);\n    if (matcher.matches())\n      return value.substring(value.indexOf(\"#\") + 1);\n    return value;\n  }\n  /** Build viewFields XML for the ListItems call.\n  */\n  protected static GetListItemsViewFields buildViewFields(String[] fieldNames)\n    throws ManifoldCFException\n  {\n    try\n    {\n      GetListItemsViewFields rval = new GetListItemsViewFields();\n      MessageElement viewFieldsNode = new MessageElement((String)null,\"ViewFields\");\n      rval.set_any(new MessageElement[]{viewFieldsNode});\n      for (String fieldName : fieldNames)\n      {\n        MessageElement child = new MessageElement((String)null,\"FieldRef\");\n        viewFieldsNode.addChild(child);\n        child.addAttribute(null,\"Name\",fieldName);\n      }\n      return rval;\n    }\n    catch (javax.xml.soap.SOAPException e)\n    {\n      throw new ManifoldCFException(e.getMessage(),e);\n    }\n  }\n  /** Build a query XML object that matches a specified field and value pair.\n  */\n  protected static GetListItemsQuery buildMatchQuery(String fieldName, String type, String value)\n    throws ManifoldCFException\n  {\n    try\n    {\n      GetListItemsQuery rval = new GetListItemsQuery();\n      MessageElement queryNode = new MessageElement((String)null,\"Query\");\n      rval.set_any(new MessageElement[]{queryNode});\n      MessageElement whereNode = new MessageElement((String)null,\"Where\");\n      queryNode.addChild(whereNode);\n      MessageElement eqNode = new MessageElement((String)null,\"Eq\");\n      whereNode.addChild(eqNode);\n      MessageElement fieldRefNode = new MessageElement((String)null,\"FieldRef\");\n      eqNode.addChild(fieldRefNode);\n      fieldRefNode.addAttribute(null,\"Name\",fieldName);\n      MessageElement valueNode = new MessageElement((String)null,\"Value\");\n      eqNode.addChild(valueNode);\n      valueNode.addAttribute(null,\"Type\",type);\n      valueNode.addTextNode(value);\n      return rval;\n    }\n    catch (javax.xml.soap.SOAPException e)\n    {\n      throw new ManifoldCFException(e.getMessage(),e);\n    }\n  }\n  /** Build a query XML object that orders by an indexed column, for paging.\n  */\n  protected static GetListItemsQuery buildOrderedQuery(String indexedColumn)\n    throws ManifoldCFException\n  {\n    try\n    {\n      GetListItemsQuery rval = new GetListItemsQuery();\n      MessageElement queryNode = new MessageElement((String)null,\"Query\");\n      rval.set_any(new MessageElement[]{queryNode});\n      MessageElement orderByNode = new MessageElement((String)null,\"OrderBy\");\n      queryNode.addChild(orderByNode);\n      orderByNode.addAttribute(null,\"Override\",\"TRUE\");\n      orderByNode.addAttribute(null,\"UseIndexForOrderBy\",\"TRUE\");\n      MessageElement fieldRefNode = new MessageElement((String)null,\"FieldRef\");\n      orderByNode.addChild(fieldRefNode);\n      fieldRefNode.addAttribute(null,\"Ascending\",\"TRUE\");\n      fieldRefNode.addAttribute(null,\"Name\",indexedColumn);\n      return rval;\n    }\n    catch (javax.xml.soap.SOAPException e)\n    {\n      throw new ManifoldCFException(e.getMessage(),e);\n    }\n  }\n  /** Build queryOptions XML object that specifies a paging value.\n  */\n  protected static GetListItemsQueryOptions buildPagingQueryOptions(String pageNextString)\n    throws ManifoldCFException\n  {\n    try\n    {\n      GetListItemsQueryOptions rval = new GetListItemsQueryOptions();\n      MessageElement queryOptionsNode = new MessageElement((String)null,\"QueryOptions\");\n      rval.set_any(new MessageElement[]{queryOptionsNode});\n      MessageElement pagingNode = new MessageElement((String)null,\"Paging\");\n      queryOptionsNode.addChild(pagingNode);\n      pagingNode.addAttribute(null,\"ListItemCollectionPositionNext\",pageNextString);\n      MessageElement viewAttributesNode = new MessageElement((String)null,\"ViewAttributes\");\n      queryOptionsNode.addChild(viewAttributesNode);\n      viewAttributesNode.addAttribute(null,\"Scope\",\"Recursive\");\n      return rval;\n    }\n    catch (javax.xml.soap.SOAPException e)\n    {\n      throw new ManifoldCFException(e.getMessage(),e);\n    }\n  }\n  /** Build queryOptions XML object that specifies no paging value.\n  */\n  protected static GetListItemsQueryOptions buildNonPagingQueryOptions()\n    throws ManifoldCFException\n  {\n    try\n    {\n      GetListItemsQueryOptions rval = new GetListItemsQueryOptions();\n      MessageElement queryOptionsNode = new MessageElement((String)null,\"QueryOptions\");\n      rval.set_any(new MessageElement[]{queryOptionsNode});\n      MessageElement viewAttributesNode = new MessageElement((String)null,\"ViewAttributes\");\n      queryOptionsNode.addChild(viewAttributesNode);\n      viewAttributesNode.addAttribute(null,\"Scope\",\"Recursive\");\n      return rval;\n    }\n    catch (javax.xml.soap.SOAPException e)\n    {\n      throw new ManifoldCFException(e.getMessage(),e);\n    }\n  }\n  /**\n  * SharePoint Permissions Service Wrapper Class\n  */\n<fim_suffix>  protected static class PermissionsWS extends com.microsoft.schemas.sharepoint.soap.directory.PermissionsLocator\n  {\n    /**\n    *\n    */\n    private static final long serialVersionUID = -2542430113046450050L;\n    private java.net.URL endPoint;\n    private String userName;\n    private String password;\n    private HttpClient httpClient;\n    public PermissionsWS ( String siteUrl, String userName, String password, EngineConfiguration configuration, HttpClient httpClient )\n      throws java.net.MalformedURLException\n    {\n      super(configuration);\n      endPoint = new java.net.URL(siteUrl + \"/_vti_bin/Permissions.asmx\");\n      this.userName = userName;\n      this.password = password;\n      this.httpClient = httpClient;\n    }\n    public com.microsoft.schemas.sharepoint.soap.directory.PermissionsSoap getPermissionsSoapHandler( )\n      throws javax.xml.rpc.ServiceException, org.apache.axis.AxisFault\n    {\n      com.microsoft.schemas.sharepoint.soap.directory.PermissionsSoapStub _stub = new com.microsoft.schemas.sharepoint.soap.directory.PermissionsSoapStub(endPoint, this);\n      _stub.setPortName(getPermissionsSoapWSDDServiceName());\n      _stub.setUsername( userName );\n      _stub.setPassword( password );\n      _stub._setProperty( HTTPCLIENT_PROPERTY, httpClient);\n      return _stub;\n    }\n  }<fim_middle>// class below has no smell\n"}