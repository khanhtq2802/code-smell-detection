{"text": "<fim_prefix>// Copyright (c) Microsoft. All rights reserved.\n// Licensed under the MIT license. See License.txt in the repository root.\n\npackage com.microsoft.tfs.client.common.ui.framework.action.keybinding;\n\nimport java.util.ArrayList;\nimport java.util.Iterator;\nimport java.util.List;\n\nimport org.eclipse.jface.action.IAction;\nimport org.eclipse.swt.widgets.Shell;\nimport org.eclipse.ui.IWorkbench;\nimport org.eclipse.ui.IWorkbenchPart;\nimport org.eclipse.ui.IWorkbenchPartSite;\nimport org.eclipse.ui.commands.ActionHandler;\nimport org.eclipse.ui.commands.HandlerSubmission;\nimport org.eclipse.ui.commands.IHandler;\nimport org.eclipse.ui.commands.IWorkbenchCommandSupport;\nimport org.eclipse.ui.commands.Priority;\n\nimport com.microsoft.tfs.util.Check;\n\npublic class LegacyActionKeyBindingSupport implements ActionKeyBindingSupport {\n    private final IWorkbenchCommandSupport workbenchCommandSupport;\n    private final Shell shell;\n    private final IWorkbenchPartSite site;\n    private final List handlerSubmissions = new ArrayList();\n\n    public LegacyActionKeyBindingSupport(final IWorkbench workbench, final IWorkbenchPart part) {\n        this(workbench, part.getSite().getShell(), part.getSite());\n    }\n\n<fim_suffix>    public LegacyActionKeyBindingSupport(final IWorkbench workbench, final Shell shell) {\n        this(workbench, shell, null);\n    }\n\n    private LegacyActionKeyBindingSupport(\n        final IWorkbench workbench,\n        final Shell shell,\n        final IWorkbenchPartSite site) {\n        Check.notNull(workbench, \"workbench\"); //$NON-NLS-1$\n        Check.notNull(shell, \"shell\"); //$NON-NLS-1$\n\n        workbenchCommandSupport = workbench.getCommandSupport();\n        this.shell = shell;\n        this.site = site;\n    }\n\n    @Override\n    public void addAction(final IAction action) {\n        Check.notNull(action, \"action\"); //$NON-NLS-1$\n\n        final String commandId = action.getActionDefinitionId();\n\n        if (commandId == null) {\n            throw new IllegalArgumentException(\"action does not have an action definition ID set\"); //$NON-NLS-1$\n        }\n\n        final IHandler handler = new ActionHandler(action);\n        final HandlerSubmission handlerSubmission =\n            new HandlerSubmission(null, shell, site, commandId, handler, Priority.MEDIUM);\n\n        workbenchCommandSupport.addHandlerSubmission(handlerSubmission);\n        handlerSubmissions.add(handlerSubmission);\n    }\n\n    @Override\n    public void dispose() {\n        for (final Iterator it = handlerSubmissions.iterator(); it.hasNext();) {\n            final HandlerSubmission handlerSubmission = (HandlerSubmission) it.next();\n            workbenchCommandSupport.removeHandlerSubmission(handlerSubmission);\n            handlerSubmission.getHandler().dispose();\n        }\n        handlerSubmissions.clear();\n    }\n}<fim_middle>// function below has no smell\n"}