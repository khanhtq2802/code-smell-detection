{"text": "<fim_prefix>/*******************************************************************************\n * Copyright (c) 2011, 2012 SAP AG and others.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *    SAP AG - initial API and implementation\n *******************************************************************************/\npackage org.eclipse.tycho.p2.remote;\n\nimport java.io.FileNotFoundException;\nimport java.io.InputStream;\nimport java.io.OutputStream;\nimport java.net.URI;\n\nimport org.eclipse.core.runtime.CoreException;\nimport org.eclipse.core.runtime.IProgressMonitor;\nimport org.eclipse.core.runtime.IStatus;\nimport org.eclipse.core.runtime.Status;\nimport org.eclipse.equinox.internal.p2.repository.AuthenticationFailedException;\nimport org.eclipse.equinox.internal.p2.repository.Transport;\nimport org.eclipse.tycho.p2.impl.Activator;\n\n/**\n * workaround for https://bugs.eclipse.org/357357\n */\n<fim_suffix>@SuppressWarnings(\"restriction\")\nclass OfflineTransport extends Transport {\n\n    private static final Status OFFLINE_STATUS = new Status(IStatus.ERROR, Activator.PLUGIN_ID, \"offline\");\n\n    @Override\n    public IStatus download(URI toDownload, OutputStream target, long startPos, IProgressMonitor monitor) {\n        throw new IllegalStateException(\"no download in offline mode\");\n    }\n\n    /*\n     * This is the only method expected to be called in offline mode.\n     * \n     * @see AbstractRepositoryManager#loadIndexFile(URI location, IProgressMonitor monitor)\n     */\n    @Override\n    public IStatus download(URI toDownload, OutputStream target, IProgressMonitor monitor) {\n        return OFFLINE_STATUS;\n    }\n\n    @Override\n    public InputStream stream(URI toDownload, IProgressMonitor monitor) throws FileNotFoundException, CoreException,\n            AuthenticationFailedException {\n        throw new IllegalStateException(\"no download in offline mode\");\n    }\n\n    @Override\n    public long getLastModified(URI toDownload, IProgressMonitor monitor) throws CoreException, FileNotFoundException,\n            AuthenticationFailedException {\n        throw new IllegalStateException(\"no download in offline mode\");\n    }\n\n}<fim_middle>// class below has no smell\n"}