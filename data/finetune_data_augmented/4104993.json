{"text": "<fim_prefix>/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\npackage org.apache.asterix.runtime.evaluators.functions.temporal;\n\nimport java.io.DataOutput;\n\nimport org.apache.asterix.formats.nontagged.SerializerDeserializerProvider;\nimport org.apache.asterix.om.base.ADuration;\nimport org.apache.asterix.om.base.AMutableDuration;\nimport org.apache.asterix.om.functions.BuiltinFunctions;\nimport org.apache.asterix.om.functions.IFunctionDescriptor;\nimport org.apache.asterix.om.functions.IFunctionDescriptorFactory;\nimport org.apache.asterix.om.types.BuiltinType;\nimport org.apache.asterix.om.types.hierachy.ATypeHierarchy;\nimport org.apache.asterix.runtime.evaluators.base.AbstractScalarFunctionDynamicDescriptor;\nimport org.apache.hyracks.algebricks.core.algebra.functions.FunctionIdentifier;\nimport org.apache.hyracks.algebricks.runtime.base.IScalarEvaluator;\nimport org.apache.hyracks.algebricks.runtime.base.IScalarEvaluatorFactory;\nimport org.apache.hyracks.api.context.IHyracksTaskContext;\nimport org.apache.hyracks.api.dataflow.value.ISerializerDeserializer;\nimport org.apache.hyracks.api.exceptions.HyracksDataException;\nimport org.apache.hyracks.data.std.api.IPointable;\nimport org.apache.hyracks.data.std.primitive.VoidPointable;\nimport org.apache.hyracks.data.std.util.ArrayBackedValueStorage;\nimport org.apache.hyracks.dataflow.common.data.accessors.IFrameTupleReference;\n\npublic class DurationFromMonthsDescriptor extends AbstractScalarFunctionDynamicDescriptor {\n\n    private final static long serialVersionUID = 1L;\n    public final static FunctionIdentifier FID = BuiltinFunctions.DURATION_FROM_MONTHS;\n    public final static IFunctionDescriptorFactory FACTORY = new IFunctionDescriptorFactory() {\n\n        @Override\n        public IFunctionDescriptor createFunctionDescriptor() {\n            return new DurationFromMonthsDescriptor();\n        }\n    };\n\n    @Override\n    public IScalarEvaluatorFactory createEvaluatorFactory(final IScalarEvaluatorFactory[] args) {\n        return new IScalarEvaluatorFactory() {\n\n            private static final long serialVersionUID = 1L;\n\n            @Override\n            public IScalarEvaluator createScalarEvaluator(final IHyracksTaskContext ctx) throws HyracksDataException {\n                return new IScalarEvaluator() {\n\n                    private ArrayBackedValueStorage resultStorage = new ArrayBackedValueStorage();\n                    private DataOutput out = resultStorage.getDataOutput();\n                    private IPointable argPtr0 = new VoidPointable();\n                    private IScalarEvaluator eval0 = args[0].createScalarEvaluator(ctx);\n\n                    @SuppressWarnings(\"unchecked\")\n                    private ISerializerDeserializer<ADuration> durationSerde =\n                            SerializerDeserializerProvider.INSTANCE.getSerializerDeserializer(BuiltinType.ADURATION);\n\n                    AMutableDuration aDuration = new AMutableDuration(0, 0);\n\n                    @Override\n                    public void evaluate(IFrameTupleReference tuple, IPointable result) throws HyracksDataException {\n                        resultStorage.reset();\n                        eval0.evaluate(tuple, argPtr0);\n                        byte[] bytes = argPtr0.getByteArray();\n                        int offset = argPtr0.getStartOffset();\n                        aDuration.setValue(ATypeHierarchy.getIntegerValue(getIdentifier().getName(), 0, bytes, offset),\n                                0);\n                        durationSerde.serialize(aDuration, out);\n                        result.set(resultStorage);\n                    }\n                };\n            }\n\n        };\n    }\n\n    /* (non-Javadoc)\n     * @see org.apache.asterix.om.functions.AbstractFunctionDescriptor#getIdentifier()\n     */\n<fim_suffix>    @Override\n    public FunctionIdentifier getIdentifier() {\n        return FID;\n    }\n\n}<fim_middle>// function below has no smell\n"}