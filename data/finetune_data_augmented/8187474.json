{"text": "<fim_prefix>/**\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements.  See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License.  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\npackage org.apache.activemq.store.kahadb;\n\nimport org.apache.activemq.command.ConnectionId;\nimport org.apache.activemq.command.LocalTransactionId;\nimport org.apache.activemq.command.TransactionId;\nimport org.apache.activemq.command.XATransactionId;\nimport org.apache.activemq.protobuf.Buffer;\nimport org.apache.activemq.store.kahadb.data.KahaLocalTransactionId;\nimport org.apache.activemq.store.kahadb.data.KahaTransactionInfo;\nimport org.apache.activemq.store.kahadb.data.KahaXATransactionId;\n\n<fim_suffix>public class TransactionIdConversion {\n\n    static KahaTransactionInfo convertToLocal(TransactionId tx) {\n        KahaTransactionInfo rc = new KahaTransactionInfo();\n        LocalTransactionId t = (LocalTransactionId) tx;\n        KahaLocalTransactionId kahaTxId = new KahaLocalTransactionId();\n        kahaTxId.setConnectionId(t.getConnectionId().getValue());\n        kahaTxId.setTransactionId(t.getValue());\n        rc.setLocalTransactionId(kahaTxId);\n        return rc;\n    }\n\n    static KahaTransactionInfo convert(TransactionId txid) {\n        if (txid == null) {\n            return null;\n        }\n        KahaTransactionInfo rc;\n\n        if (txid.isLocalTransaction()) {\n            rc = convertToLocal(txid);\n        } else {\n            rc = new KahaTransactionInfo();\n            XATransactionId t = (XATransactionId) txid;\n            KahaXATransactionId kahaTxId = new KahaXATransactionId();\n            kahaTxId.setBranchQualifier(new Buffer(t.getBranchQualifier()));\n            kahaTxId.setGlobalTransactionId(new Buffer(t.getGlobalTransactionId()));\n            kahaTxId.setFormatId(t.getFormatId());\n            rc.setXaTransactionId(kahaTxId);\n        }\n        return rc;\n    }\n\n    static TransactionId convert(KahaTransactionInfo transactionInfo) {\n        if (transactionInfo.hasLocalTransactionId()) {\n            KahaLocalTransactionId tx = transactionInfo.getLocalTransactionId();\n            LocalTransactionId rc = new LocalTransactionId();\n            rc.setConnectionId(new ConnectionId(tx.getConnectionId()));\n            rc.setValue(tx.getTransactionId());\n            return rc;\n        } else {\n            KahaXATransactionId tx = transactionInfo.getXaTransactionId();\n            XATransactionId rc = new XATransactionId();\n            rc.setBranchQualifier(tx.getBranchQualifier().toByteArray());\n            rc.setGlobalTransactionId(tx.getGlobalTransactionId().toByteArray());\n            rc.setFormatId(tx.getFormatId());\n            return rc;\n        }\n    }\n}<fim_middle>// class below has no smell\n"}