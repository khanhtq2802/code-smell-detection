{"text": "<fim_prefix>/********************************************************************************\n * Copyright (c) 2011-2017 Red Hat Inc. and/or its affiliates and others\n *\n * This program and the accompanying materials are made available under the \n * terms of the Apache License, Version 2.0 which is available at\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * SPDX-License-Identifier: Apache-2.0 \n ********************************************************************************/\npackage org.eclipse.ceylon.model.loader.impl.reflect.model;\n\nimport java.util.List;\n\nimport org.eclipse.ceylon.model.loader.AbstractModelLoader;\nimport org.eclipse.ceylon.model.loader.model.LazyModule;\nimport org.eclipse.ceylon.model.typechecker.model.Package;\n\n<fim_suffix>public class ReflectionModule extends LazyModule {\n\n    private ReflectionModuleManager modelManager;\n    private boolean packagesLoaded = false;\n\n    public ReflectionModule(ReflectionModuleManager reflectionModuleManager) {\n        this.modelManager = reflectionModuleManager;\n    }\n\n    @Override\n    protected AbstractModelLoader getModelLoader() {\n        return modelManager.getModelLoader();\n    }\n    \n    @Override\n    public List<Package> getPackages() {\n        // make sure we're complete\n        final AbstractModelLoader modelLoader = getModelLoader();\n        if(!packagesLoaded){\n            modelLoader.synchronizedRun(new Runnable() {\n                @Override\n                public void run() {\n                    if(!packagesLoaded){\n                        String name = getNameAsString();\n                        for(String pkg : getJarPackages()){\n                            // special case for the language module to hide stuff\n                            if(!name.equals(AbstractModelLoader.CEYLON_LANGUAGE) || pkg.startsWith(AbstractModelLoader.CEYLON_LANGUAGE))\n                                modelLoader.findOrCreatePackage(ReflectionModule.this, pkg);\n                        }\n                        packagesLoaded = true;\n                    }\n                }\n            });\n        }\n        return super.getPackages();\n    }\n}<fim_middle>// class below has no smell\n"}