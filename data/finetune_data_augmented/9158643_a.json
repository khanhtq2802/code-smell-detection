{"text": "<fim_prefix>/*******************************************************************************\n * Copyright (c) 2004 Actuate Corporation.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *  Actuate Corporation  - initial API and implementation\n *******************************************************************************/\n\npackage org.eclipse.birt.report.designer.ui.ide.navigator;\n\nimport java.util.HashMap;\nimport java.util.Map;\n\nimport org.eclipse.birt.report.designer.ui.ReportPlugin;\nimport org.eclipse.birt.report.designer.ui.actions.IPreviewAction;\nimport org.eclipse.birt.report.designer.ui.preview.IPreviewConstants;\nimport org.eclipse.birt.report.designer.ui.preview.PreviewUtil;\nimport org.eclipse.birt.report.designer.ui.util.ExceptionUtil;\nimport org.eclipse.birt.report.designer.ui.views.ElementAdapterManager;\nimport org.eclipse.birt.report.viewer.utilities.WebViewer;\nimport org.eclipse.core.resources.IFile;\nimport org.eclipse.jface.action.IAction;\n\n/**\n * The action to generate report document in navigator view\n */\npublic class GenerateDocumentAction extends AbstractViewAction\n{\n\n\tprotected boolean preGenerate( )\n\t{\n\t\tPreviewUtil.clearSystemProperties();\n\t\treturn true;\n\t}\n\n<fim_suffix>\tpublic void run( IAction action )\n\t{\n\t\tif ( !preGenerate( ) )\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tIFile file = getSelectedFile( );\n\t\tif ( file != null )\n\t\t{\n\t\t\tString url = file.getLocation( ).toOSString( );\n\n\t\t\tMap options = new HashMap( );\n\t\t\toptions.put( WebViewer.RESOURCE_FOLDER_KEY,\n\t\t\t\t\tReportPlugin.getDefault( )\n\t\t\t\t\t\t\t.getResourceFolder( file.getProject( ) ) );\n\t\t\toptions.put( WebViewer.SERVLET_NAME_KEY, WebViewer.VIEWER_DOCUMENT );\n\n\t\t\tObject adapter = ElementAdapterManager.getAdapter( action,\n\t\t\t\t\tIPreviewAction.class );\n\n\t\t\tif ( adapter instanceof IPreviewAction )\n\t\t\t{\n\t\t\t\tIPreviewAction delegate = (IPreviewAction) adapter;\n\n\t\t\t\tdelegate.setProperty( IPreviewConstants.REPORT_PREVIEW_OPTIONS,\n\t\t\t\t\t\toptions );\n\t\t\t\tdelegate.setProperty( IPreviewConstants.REPORT_FILE_PATH, url );\n\n\t\t\t\tdelegate.run( );\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tWebViewer.display( url, options );\n\t\t\t}\n\t\t\tcatch ( Exception e )\n\t\t\t{\n\t\t\t\tExceptionUtil.handle( e );\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\taction.setEnabled( false );\n\t\t}\n\t}\n\n}<fim_middle>// function below is feature envy and long method\n"}