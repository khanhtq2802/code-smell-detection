{"text": "<fim_prefix>/*\n * Copyright 2010-2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\").\n * You may not use this file except in compliance with the License.\n * A copy of the License is located at\n *\n *  http://aws.amazon.com/apache2.0\n *\n * or in the \"license\" file accompanying this file. This file is distributed\n * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n * express or implied. See the License for the specific language governing\n * permissions and limitations under the License.\n */\n\npackage software.amazon.awssdk.codegen.model.intermediate;\n\nimport com.fasterxml.jackson.annotation.JsonCreator;\nimport com.fasterxml.jackson.annotation.JsonIgnore;\nimport com.fasterxml.jackson.annotation.JsonProperty;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.time.ZonedDateTime;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.stream.Collectors;\nimport software.amazon.awssdk.awscore.AwsResponse;\nimport software.amazon.awssdk.awscore.AwsResponseMetadata;\nimport software.amazon.awssdk.codegen.internal.Utils;\nimport software.amazon.awssdk.codegen.model.config.customization.CustomizationConfig;\nimport software.amazon.awssdk.codegen.model.service.PaginatorDefinition;\nimport software.amazon.awssdk.codegen.naming.NamingStrategy;\nimport software.amazon.awssdk.utils.IoUtils;\n\n<fim_suffix>public final class IntermediateModel {\n    private final Metadata metadata;\n\n    private final Map<String, OperationModel> operations;\n\n    private final Map<String, ShapeModel> shapes;\n\n    private final CustomizationConfig customizationConfig;\n\n    private final ServiceExamples examples;\n\n    private final Map<String, AuthorizerModel> customAuthorizers;\n\n    @JsonIgnore\n    private final Optional<OperationModel> endpointOperation;\n\n    @JsonIgnore\n    private final Map<String, PaginatorDefinition> paginators;\n\n    @JsonIgnore\n    private final NamingStrategy namingStrategy;\n\n    @JsonCreator\n    public IntermediateModel(\n        @JsonProperty(\"metadata\") Metadata metadata,\n        @JsonProperty(\"operations\") Map<String, OperationModel> operations,\n        @JsonProperty(\"shapes\") Map<String, ShapeModel> shapes,\n        @JsonProperty(\"customizationConfig\") CustomizationConfig customizationConfig,\n        @JsonProperty(\"serviceExamples\") ServiceExamples examples) {\n\n        this(metadata, operations, shapes, customizationConfig, examples, null,\n             Collections.emptyMap(), Collections.emptyMap(), null);\n    }\n\n    public IntermediateModel(\n        Metadata metadata,\n        Map<String, OperationModel> operations,\n        Map<String, ShapeModel> shapes,\n        CustomizationConfig customizationConfig,\n        ServiceExamples examples,\n        OperationModel endpointOperation,\n        Map<String, AuthorizerModel> customAuthorizers,\n        Map<String, PaginatorDefinition> paginators,\n        NamingStrategy namingStrategy) {\n        this.metadata = metadata;\n        this.operations = operations;\n        this.shapes = shapes;\n        this.customizationConfig = customizationConfig;\n        this.examples = examples;\n        this.endpointOperation = Optional.ofNullable(endpointOperation);\n        this.customAuthorizers = customAuthorizers;\n        this.paginators = paginators;\n        this.namingStrategy = namingStrategy;\n    }\n\n    public Metadata getMetadata() {\n        return metadata;\n    }\n\n    public Map<String, OperationModel> getOperations() {\n        return operations;\n    }\n\n    public OperationModel getOperation(String operationName) {\n        return getOperations().get(operationName);\n    }\n\n    public Map<String, ShapeModel> getShapes() {\n        return shapes;\n    }\n\n    public ShapeModel getShapeByC2jName(String c2jName) {\n        return Utils.findShapeModelByC2jName(this, c2jName);\n    }\n\n    public CustomizationConfig getCustomizationConfig() {\n        return customizationConfig;\n    }\n\n    public ServiceExamples getExamples() {\n        return examples;\n    }\n\n    public Map<String, PaginatorDefinition> getPaginators() {\n        return paginators;\n    }\n\n    public NamingStrategy getNamingStrategy() {\n        return namingStrategy;\n    }\n\n    public String getCustomRetryPolicy() {\n        return customizationConfig.getCustomRetryPolicy();\n    }\n\n    public String getSdkModeledExceptionBaseFqcn() {\n        return String.format(\"%s.%s\",\n                             metadata.getFullModelPackageName(),\n                             getSdkModeledExceptionBaseClassName());\n    }\n\n    public String getSdkModeledExceptionBaseClassName() {\n        if (customizationConfig.getSdkModeledExceptionBaseClassName() != null) {\n            return customizationConfig.getSdkModeledExceptionBaseClassName();\n        } else {\n            return metadata.getBaseExceptionName();\n        }\n    }\n\n    public String getSdkRequestBaseClassName() {\n        if (customizationConfig.getSdkRequestBaseClassName() != null) {\n            return customizationConfig.getSdkRequestBaseClassName();\n        } else {\n            return metadata.getBaseRequestName();\n        }\n    }\n\n    public String getSdkResponseBaseClassName() {\n        if (customizationConfig.getSdkResponseBaseClassName() != null) {\n            return customizationConfig.getSdkResponseBaseClassName();\n        } else {\n            return metadata.getBaseResponseName();\n        }\n    }\n\n    public String getFileHeader() throws IOException {\n        return loadDefaultFileHeader();\n    }\n\n    private String loadDefaultFileHeader() throws IOException {\n        try (InputStream inputStream = getClass()\n            .getResourceAsStream(\"/software/amazon/awssdk/codegen/DefaultFileHeader.txt\")) {\n            return IoUtils.toUtf8String(inputStream)\n                          .replaceFirst(\"%COPYRIGHT_DATE_RANGE%\", getCopyrightDateRange());\n        }\n    }\n\n    private String getCopyrightDateRange() {\n        int currentYear = ZonedDateTime.now().getYear();\n        int copyrightStartYear = currentYear - 5;\n        return String.format(\"%d-%d\", copyrightStartYear, currentYear);\n    }\n\n    public String getSdkBaseResponseFqcn() {\n        if (metadata.getProtocol() == Protocol.API_GATEWAY) {\n            return \"software.amazon.awssdk.opensdk.BaseResult\";\n        } else {\n            return String.format(\"%s<%s>\",\n                                 AwsResponse.class.getName(),\n                                 getResponseMetadataClassName());\n        }\n    }\n\n    private String getResponseMetadataClassName() {\n        return AwsResponseMetadata.class.getName();\n    }\n\n    @JsonIgnore\n    public List<OperationModel> simpleMethodsRequiringTesting() {\n        return getOperations().values().stream()\n                              .filter(v -> v.getInputShape().isSimpleMethod())\n                              .collect(Collectors.toList());\n    }\n\n    public Map<String, AuthorizerModel> getCustomAuthorizers() {\n        return customAuthorizers;\n    }\n\n    public Optional<OperationModel> getEndpointOperation() {\n        return endpointOperation;\n    }\n\n    public boolean hasPaginators() {\n        return paginators.size() > 0;\n    }\n\n    public boolean containsRequestSigners() {\n        return getShapes().values().stream()\n                          .filter(ShapeModel::isRequestSignerAware)\n                          .findAny()\n                          .isPresent();\n    }\n\n    public boolean containsRequestEventStreams() {\n        return getOperations().values().stream()\n                              .filter(opModel -> opModel.hasEventStreamInput())\n                              .findAny()\n                              .isPresent();\n    }\n}<fim_middle>// class below is data class\n"}