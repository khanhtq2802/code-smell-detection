{"text": "<fim_prefix>\t\t\t\tthrows IllegalArgumentException, IntrospectionException,\n\t\t\t\tIllegalAccessException, InvocationTargetException\n\t\t{\n\t\t\tcmbDataType = new CCombo( parent, SWT.READ_ONLY | SWT.BORDER );\n\t\t\tcmbDataType.setLayoutData( ControlProvider.getGridDataWithHSpan( 2 ) );\n\t\t\tString selectedItem = data.getDataTypeName( ); \n\t\t\toriginalDataType = selectedItem;\n\t\t\tcmbDataType.add( dataTypes.findChoice( selectedItem ).getDisplayName( ) );\n\t\t\tString[] compatibleDisplayNames = getCompatibleDataTypes ( selectedItem );\n\t\t\tfor( int i = 0 ; i <compatibleDisplayNames.length ; i++ )\n\t\t\t{\n\t\t\t\tcmbDataType.add( compatibleDisplayNames[i] );\n\t\t\t}\n\t\t\tcmbDataType.select( 0 );\n\t\t\tDataSetHandle dataSetHandle = (DataSetHandle) getContainer( ).getModel( );\n\t\t\tif ( dataSetHandle instanceof OdaDataSetHandle )\n\t\t\t{\n\t\t\t\tDataSetViewData[] views = DataSetProvider.getCurrentInstance( )\n\t\t\t\t\t\t.getCachedDataSetItemModel( dataSetHandle, false );\n\t\t\t\tfor ( int i = 0; i < views.length; i++ )\n\t\t\t\t{\n\t\t\t\t\tif ( views[i].getName( ).equals( data.getName( ) ) )\n\t\t\t\t\t{\n\t\t\t\t\t\tif ( !views[i].getDataTypeName( )\n\t\t\t\t\t\t\t\t.equals( data.getDataTypeName( ) ) )\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif ( cmbDataType.indexOf( views[i].getDataTypeDisplayName( ) ) < 0 )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcmbDataType.add( views[i].getDataTypeDisplayName( ) );\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t\tcmbDataType.setEnabled( false );\n\t\t\tif ( data.isComputedColumn( ) )\n\t\t\t{\n\t\t\t\tcmbDataType.setEnabled( false );\n\t\t\t}\n\t\t\tcmbDataType.addSelectionListener( new SelectionListener(){\n\t\t\t\tpublic void widgetSelected( SelectionEvent e )\n\t\t\t\t{\n\t\t\t\t\tif ( checkForPotentialProblems( originalDataType ) )\n\t\t\t\t\t{\n\t\t\t\t\t\tif ( MessageDialog.openQuestion( getShell( ),\n\t\t\t\t\t\t\t\tMessages.getString( \"OutputColumnsPage.DataTypeConvert.Note\" ),\n\t\t\t\t\t\t\t\tMessages.getString( \"OutputColumnsPage.DataTypeConvert.Message\" )\n\t\t\t\t\t\t ) )\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata.setDataTypeName( dataTypes.findChoiceByDisplayName( cmbDataType.getText( ) )\n\t\t\t\t\t\t\t\t\t.getName( ) );\n\t\t\t\t\t\t\tdata.setDataType( DataAdapterUtil.adaptModelDataType( dataTypes.findChoiceByDisplayName( cmbDataType.getText( ) )\n\t\t\t\t\t\t\t\t\t.getName( ) ));\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse \n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcmbDataType.select( 0 );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.setDataTypeName( dataTypes.findChoiceByDisplayName( cmbDataType.getText( ) )\n\t\t\t\t\t\t\t\t.getName( ) );\n\t\t\t\t\t\tdata.setDataType( DataAdapterUtil.adaptModelDataType( dataTypes.findChoiceByDisplayName( cmbDataType.getText( ) )\n\t\t\t\t\t\t\t\t.getName( ) ));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tpublic void widgetDefaultSelected( SelectionEvent e )\n\t\t\t\t{\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tprivate void createTextCell( Composite parent, final int index )\n\t\t\t\tthrows IllegalArgumentException, IntrospectionException,\n\t\t\t\tIllegalAccessException, InvocationTargetException\n\t\t{\n\t\t\tfinal Text tx = ControlProvider.createText( parent,\n\t\t\t\t\t(String) Utility.getProperty( data, cellProperties[index] ) );\n\t\t\ttx.setLayoutData( ControlProvider.getGridDataWithHSpan( 2 ) );\n\t\t\tif ( index < 2 )// disable name and dataTypeName\n\t\t\t{\n\t\t\t\ttx.setEditable( false );\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttx.addModifyListener( new ModifyListener( ) {\n\t\t\t\t\tpublic void modifyText( ModifyEvent e )\n\t\t\t\t\t{\n\t\t\t\t\t\ttry\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif ( index == 2 )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tboolean isUniqueName = isUnique( tx.getText( ), data );\n\t\t\t\t\t\t\t\tif ( !isUniqueName )\n\t\t\t\t\t\t\t\t\tupdateStatus( getMiscStatus( IStatus.ERROR,\n\t\t\t\t\t\t\t\t\t\t\tMessages.getString( \"OutputColumnPage.OutputColumns.DuplicatedName\" ) ) ); //$NON-NLS-1$\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tupdateStatus( getOKStatus( ) );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tObject txText = tx.getText( );\n\t\t\t\t\t\t\tif ( tx.getText( ).trim( ).length( ) == 0 )\n\t\t\t\t\t\t\t\ttxText = null;\n\t\t\t\t\t\t\tUtility.setProperty( data,\n\t\t\t\t\t\t\t\t\tcellProperties[index],\n\t\t\t\t\t\t\t\t\ttxText );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch ( Exception e1 )\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tExceptionHandler.handle( e1 );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t\tif ( index == 2 )\n\t\t\t{\n\t\t\t\ttx.setFocus( );\n\t\t\t}\n\t\t}\n\t\tprivate void createResourceCell( Composite parent, final int index )\n\t\t\t\tthrows IllegalArgumentException, IntrospectionException,\n\t\t\t\tIllegalAccessException, InvocationTargetException\n\t\t{\n\t\t\tfinal Text tx = ControlProvider.createText( parent,\n\t\t\t\t\t(String) Utility.getProperty( data, cellProperties[index] ) );\n\t\t\ttx.setLayoutData( ControlProvider.getGridDataWithHSpan( 1 ) );\n\t\t\ttx.addModifyListener( new ModifyListener( ) {\n\t\t\t\tpublic void modifyText( ModifyEvent e )\n\t\t\t\t{\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tUtility.setProperty( data,\n\t\t\t\t\t\t\t\tcellProperties[index],\n\t\t\t\t\t\t\t\ttx.getText( ) );\n\t\t\t\t\t\tboolean check = checkDisplayNameKey( tx.getText( ) );\n\t\t\t\t\t\tif ( !check )\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tupdateStatus( getMiscStatus( IStatus.ERROR, Messages.getString( \"ResourceKey.invalid.containSpace\" ) ) );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcatch ( Exception e1 )\n\t\t\t\t\t{\n\t\t\t\t\t\tExceptionHandler.handle( e1 );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\t\t\tSelectionAdapter listener = new SelectionAdapter( ) {\n\t\t\t\tpublic void widgetSelected( SelectionEvent event )\n\t\t\t\t{\n\t\t\t\t\tResourceEditDialog dlg = new ResourceEditDialog( getShell( ),\n\t\t\t\t\t\t\tMessages.getString( \"ResourceKeyDescriptor.title.SelectKey\" ) ); //$NON-NLS-1$\n\t\t\t\t\tdlg.setResourceURLs( getResourceURLs( ) );\n\t\t\t\t\tif ( dlg.open( ) == Window.OK )\n\t\t\t\t\t{\n\t\t\t\t\t\ttx.setText( (String) dlg.getResult( ) );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tButton bt = new Button( parent, SWT.PUSH );\n\t\t\tbt.setText( \"...\" ); //$NON-NLS-1$\n\t\t\tbt.addSelectionListener( listener );\n\t\t\tif ( getBaseName( ) == null )\n\t\t\t\tbt.setEnabled( false );\n\t\t}\n\t\tprivate String[] getBaseNames( )\n\t\t{\n\t\t\tList<String> resources = SessionHandleAdapter.getInstance( )\n\t\t\t\t\t.getReportDesignHandle( )\n\t\t\t\t\t.getIncludeResources( );\n\t\t\tif ( resources == null )\n\t\t\t\treturn null;\n\t\t\telse\n\t\t\t\treturn resources.toArray( new String[0] );\n\t\t}\n\t\tprivate URL[] getResourceURLs( )\n\t\t{\n\t\t\tString[] baseNames = getBaseNames( );\n\t\t\tif ( baseNames == null )\n\t\t\t\treturn null;\n\t\t\telse\n\t\t\t{\n\t\t\t\tURL[] urls = new URL[baseNames.length];\n\t\t\t\tfor ( int i = 0; i < baseNames.length; i++ )\n\t\t\t\t{\n\t\t\t\t\turls[i] = SessionHandleAdapter.getInstance( )\n\t\t\t\t\t\t\t.getReportDesignHandle( )\n\t\t\t\t\t\t\t.findResource( baseNames[i],\n\t\t\t\t\t\t\t\t\tIResourceLocator.MESSAGE_FILE );\n\t\t\t\t}\n\t\t\t\treturn urls;\n\t\t\t}\n\t\t}\n\t\tprivate String getBaseName( )\n\t\t{\n\t\t\treturn SessionHandleAdapter.getInstance( )\n\t\t\t\t\t.getReportDesignHandle( )\n\t\t\t\t\t.getIncludeResource( );\n\t\t}\n\t\t/*\n\t\t * (non-Javadoc)\n\t\t * \n\t\t * @see org.eclipse.birt.report.designer.data.ui.dataset.PropertyHandleInputDialog#rollback()\n\t\t */\n<fim_suffix>\t\tprotected void rollback( )\n\t\t{\n\t\t\tdata.setAlias( originalAlias );\n\t\t\tdata.setRealDisplayName( originalDisplayName );\n\t\t\tdata.setDisplayNameKey( originalDisplayNameKey );\n\t\t}<fim_middle>// function below has no smell\n"}