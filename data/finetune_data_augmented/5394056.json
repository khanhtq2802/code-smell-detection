{"text": "<fim_prefix>                \"CLIENT 4 ROW LIMIT\\n\" +\n                \"    PARALLEL INNER-JOIN TABLE 0\\n\" +\n                \"        CLIENT PARALLEL 1-WAY FULL SCAN OVER \" + JOIN_ORDER_TABLE_FULL_NAME + \"\\n\" +\n                \"    DYNAMIC SERVER FILTER BY \\\"I.:item_id\\\" IN (\\\"O.item_id\\\")\\n\" +\n                \"    JOIN-SCANNER 4 ROW LIMIT\",\n                /*\n                 * testJoinWithOffset()\n                 *     SELECT order_id, i.name, s.name, s.address, quantity \n                 *     FROM joinSupplierTable s \n                 *     LEFT JOIN joinItemTable i ON i.supplier_id = s.supplier_id \n                 *     LEFT JOIN joinOrderTable o ON o.item_id = i.item_id LIMIT 1 OFFSET 2\n                 */\n                \"CLIENT SERIAL 1-WAY FULL SCAN OVER \" + JOIN_SUPPLIER_TABLE_FULL_NAME + \"\\n\" +\n                \"    SERVER OFFSET 2\\n\" +\n                \"    SERVER 3 ROW LIMIT\\n\" +\n                \"CLIENT 1 ROW LIMIT\\n\" +\n                \"    PARALLEL LEFT-JOIN TABLE 0\\n\" +\n                \"        CLIENT PARALLEL 1-WAY RANGE SCAN OVER \"+ JOIN_ITEM_TABLE_FULL_NAME + \" [1]\\n\" +\n                \"        CLIENT MERGE SORT\\n\" +      \n                \"    PARALLEL LEFT-JOIN TABLE 1(DELAYED EVALUATION)\\n\" +\n                \"        CLIENT PARALLEL 1-WAY FULL SCAN OVER \"+ JOIN_ORDER_TABLE_FULL_NAME + \"\\n\" +\n                \"    JOIN-SCANNER 3 ROW LIMIT\",\n                /*\n                 * testJoinWithOffset()\n                 *     SELECT order_id, i.name, s.name, s.address, quantity \n                 *     FROM joinSupplierTable s \n                 *     JOIN joinItemTable i ON i.supplier_id = s.supplier_id \n                 *     JOIN joinOrderTable o ON o.item_id = i.item_id LIMIT 1 OFFSET 2\n                 */\n                \"CLIENT SERIAL 1-WAY FULL SCAN OVER \" + JOIN_SUPPLIER_TABLE_FULL_NAME + \"\\n\" +\n                \"    SERVER OFFSET 2\\n\" +\n                \"CLIENT 1 ROW LIMIT\\n\" +\n                \"    PARALLEL INNER-JOIN TABLE 0\\n\" +\n                \"        CLIENT PARALLEL 1-WAY RANGE SCAN OVER \"+ JOIN_ITEM_TABLE_FULL_NAME + \" [1]\\n\" +\n                \"        CLIENT MERGE SORT\\n\" +\n                \"    PARALLEL INNER-JOIN TABLE 1(DELAYED EVALUATION)\\n\" +\n                \"        CLIENT PARALLEL 1-WAY FULL SCAN OVER \"+ JOIN_ORDER_TABLE_FULL_NAME + \"\\n\" +\n                \"    DYNAMIC SERVER FILTER BY \\\"S.supplier_id\\\" IN (\\\"I.0:supplier_id\\\")\\n\" +\n                \"    JOIN-SCANNER 3 ROW LIMIT\",\n                /*\n                 * testJoinWithLocalIndex()\n                 *     SELECT phone, i.name \n                 *     FROM joinSupplierTable s \n                 *     JOIN joinItemTable i ON s.supplier_id = i.supplier_id \n                 *     WHERE s.name = 'S1' AND i.name < 'T6'\n                 */\n                \"CLIENT PARALLEL 1-WAY RANGE SCAN OVER \" + JOIN_SUPPLIER_TABLE_FULL_NAME + \" [1,'S1']\\n\" + \n                \"    SERVER FILTER BY FIRST KEY ONLY\\n\" + \n                \"CLIENT MERGE SORT\\n\" + \n                \"    PARALLEL INNER-JOIN TABLE 0\\n\" + \n                \"        CLIENT PARALLEL 1-WAY RANGE SCAN OVER \" + JOIN_ITEM_TABLE_FULL_NAME + \" [1,*] - [1,'T6']\\n\" + \n                \"        CLIENT MERGE SORT\\n\" + \n                \"    DYNAMIC SERVER FILTER BY \\\"S.:supplier_id\\\" IN (\\\"I.0:supplier_id\\\")\",\n                /*\n                 * testJoinWithLocalIndex()\n                 *     SELECT phone, max(i.name) \n                 *     FROM joinSupplierTable s \n                 *     JOIN joinItemTable i ON s.\"supplier_id\" = i.\"supplier_id\" \n                 *     WHERE s.name = 'S1' AND i.name < 'T6' \n                 *     GROUP BY phone\n                 */\n                \"CLIENT PARALLEL 1-WAY RANGE SCAN OVER \" + JOIN_SUPPLIER_TABLE_FULL_NAME + \" [1,'S1']\\n\" + \n                \"    SERVER FILTER BY FIRST KEY ONLY\\n\" + \n                \"    SERVER AGGREGATE INTO DISTINCT ROWS BY [\\\"S.PHONE\\\"]\\n\" + \n                \"CLIENT MERGE SORT\\n\" + \n                \"    PARALLEL INNER-JOIN TABLE 0\\n\" + \n                \"        CLIENT PARALLEL 1-WAY RANGE SCAN OVER \" + JOIN_ITEM_TABLE_FULL_NAME + \" [1,*] - [1,'T6']\\n\" + \n                \"        CLIENT MERGE SORT\\n\" + \n                \"    DYNAMIC SERVER FILTER BY \\\"S.:supplier_id\\\" IN (\\\"I.0:supplier_id\\\")\",\n                /*\n                 * testJoinWithLocalIndex()\n                 *     SELECT max(phone), max(i.name) \n                 *     FROM joinSupplierTable s \n                 *     LEFT JOIN joinItemTable i ON s.\"supplier_id\" = i.\"supplier_id\" AND i.name < 'T6' \n                 *     WHERE s.name <= 'S3'\n                 */\n                \"CLIENT PARALLEL 1-WAY RANGE SCAN OVER \" + JOIN_SUPPLIER_TABLE_FULL_NAME + \" [1,*] - [1,'S3']\\n\" +\n                \"    SERVER FILTER BY FIRST KEY ONLY\\n\" + \n                \"    SERVER AGGREGATE INTO SINGLE ROW\\n\" +\n                \"    PARALLEL LEFT-JOIN TABLE 0\\n\" +\n                \"        CLIENT PARALLEL 1-WAY RANGE SCAN OVER \" + JOIN_ITEM_TABLE_FULL_NAME + \" [1,*] - [1,'T6']\\n\" +\n                \"        CLIENT MERGE SORT\",\n                }});\n        return testCases;\n    }\n<fim_suffix>    @Test\n    public void testJoinWithLocalIndex() throws Exception {\n        Properties props = PropertiesUtil.deepCopy(TEST_PROPERTIES);\n        Connection conn = DriverManager.getConnection(getUrl(), props);\n        try {            \n            String query = \"select phone, i.name from \" + getTableName(conn, JOIN_SUPPLIER_TABLE_FULL_NAME) + \" s join \" + getTableName(conn, JOIN_ITEM_TABLE_FULL_NAME) + \" i on s.\\\"supplier_id\\\" = i.\\\"supplier_id\\\" where s.name = 'S1' and i.name < 'T6'\";\n            System.out.println(\"1)\\n\" + query);\n            PreparedStatement statement = conn.prepareStatement(query);\n            ResultSet rs = statement.executeQuery();\n            assertTrue (rs.next());\n            assertEquals(rs.getString(1), \"888-888-1111\");\n            assertTrue (rs.next());\n            assertEquals(rs.getString(1), \"888-888-1111\");\n            assertFalse(rs.next());\n            rs = conn.createStatement().executeQuery(\"EXPLAIN \" + query);\n            assertPlansEqual(plans[24], QueryUtil.getExplainPlan(rs));\n            query = \"select phone, max(i.name) from \" + getTableName(conn, JOIN_SUPPLIER_TABLE_FULL_NAME) + \" s join \" + getTableName(conn, JOIN_ITEM_TABLE_FULL_NAME) + \" i on s.\\\"supplier_id\\\" = i.\\\"supplier_id\\\" where s.name = 'S1' and i.name < 'T6' group by phone\";\n            statement = conn.prepareStatement(query);\n            rs = statement.executeQuery();\n            assertTrue (rs.next());\n            assertEquals(rs.getString(1), \"888-888-1111\");\n            assertEquals(rs.getString(2), \"T2\");\n            assertFalse(rs.next());\n            rs = conn.createStatement().executeQuery(\"EXPLAIN \" + query);\n            assertPlansEqual(plans[25], QueryUtil.getExplainPlan(rs));\n            query = \"select max(phone), max(i.name) from \" + getTableName(conn, JOIN_SUPPLIER_TABLE_FULL_NAME) + \" s left join \" + getTableName(conn, JOIN_ITEM_TABLE_FULL_NAME) + \" i on s.\\\"supplier_id\\\" = i.\\\"supplier_id\\\" and i.name < 'T6' where s.name <= 'S3'\";\n            statement = conn.prepareStatement(query);\n            rs = statement.executeQuery();\n            assertTrue (rs.next());\n            assertEquals(rs.getString(1), \"888-888-3333\");\n            assertEquals(rs.getString(2), \"T4\");\n            assertFalse(rs.next());\n            rs = conn.createStatement().executeQuery(\"EXPLAIN \" + query);\n            assertPlansEqual(plans[26], QueryUtil.getExplainPlan(rs));\n        } finally {\n            conn.close();\n        }\n    }<fim_middle>// function below has no smell\n"}