{"text": "<fim_prefix>/*\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements.  See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License.  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage org.apache.unomi.shell.migration.impl;\n\nimport org.apache.http.impl.client.CloseableHttpClient;\nimport org.apache.karaf.shell.api.console.Session;\nimport org.apache.unomi.shell.migration.Migration;\nimport org.apache.unomi.shell.migration.utils.ConsoleUtils;\nimport org.apache.unomi.shell.migration.utils.HttpRequestException;\nimport org.apache.unomi.shell.migration.utils.HttpUtils;\nimport org.osgi.framework.Version;\nimport org.osgi.service.component.annotations.Component;\n\nimport java.io.IOException;\n\n<fim_suffix>@Component\npublic class MigrationTo122 implements Migration {\n    private CloseableHttpClient httpClient;\n    private Session session;\n    private String esAddress;\n\n    @Override\n    public Version getFromVersion() {\n        return null;\n    }\n\n    @Override\n    public Version getToVersion() {\n        return new Version(\"1.2.2\");\n    }\n\n    @Override\n    public String getDescription() {\n        return \"Delete old index template\";\n    }\n\n    @Override\n    public void execute(Session session, CloseableHttpClient httpClient, String esAddress) throws IOException {\n        this.httpClient = httpClient;\n        this.session = session;\n        this.esAddress = esAddress;\n        deleteOldIndexTemplate();\n\n    }\n\n    private void deleteOldIndexTemplate() throws IOException {\n        String oldMonthlyIndexTemplate = \"context_monthlyindex\";\n        try {\n            ConsoleUtils.printMessage(session,\"Deleting old monthly index template \" + oldMonthlyIndexTemplate);\n            HttpUtils.executeDeleteRequest(httpClient, esAddress + \"/_template/\" + oldMonthlyIndexTemplate, null);\n        } catch (HttpRequestException e) {\n            if (e.getCode() == 404) {\n                ConsoleUtils.printMessage(session,\"Old monthly index template not found, skipping deletion\");\n            } else {\n                throw e;\n            }\n        }\n\n    }\n}<fim_middle>// class below has no smell\n"}