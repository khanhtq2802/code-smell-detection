{"text": "<fim_prefix>/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\npackage org.apache.tajo.engine.function;\n\nimport org.apache.tajo.catalog.Column;\nimport org.apache.tajo.common.TajoDataTypes;\nimport org.apache.tajo.common.TajoDataTypes.Type;\nimport org.apache.tajo.datum.Datum;\nimport org.apache.tajo.datum.DatumFactory;\nimport org.apache.tajo.engine.function.annotation.Description;\nimport org.apache.tajo.engine.function.annotation.ParamTypes;\nimport org.apache.tajo.exception.TajoInternalError;\nimport org.apache.tajo.plan.function.GeneralFunction;\nimport org.apache.tajo.storage.Tuple;\n\n<fim_suffix>@Description(\n    functionName = \"fail\",\n    description = \"Cause some error if the second parameter value is greater than the first parameter\",\n    example = \"> SELECT fail(1, col1, 'message');\\n\"\n        + \"1\",\n    returnType = Type.INT4,\n    paramTypes = {\n        @ParamTypes(paramTypes = {Type.INT4, Type.INT4, Type.TEXT}),\n    }\n)\npublic class FailFunction extends GeneralFunction {\n\n  public FailFunction() {\n    super(new Column[]{\n        new Column(\"trigger\", TajoDataTypes.Type.INT4),\n        new Column(\"input_number\", TajoDataTypes.Type.INT4),\n        new Column(\"message\", TajoDataTypes.Type.TEXT)\n    });\n  }\n\n  @Override\n  public Datum eval(Tuple params) {\n\n    // to skip the plannin phase\n    if (params.isBlankOrNull(0) && params.isBlankOrNull(1)) {\n      return DatumFactory.createInt4(params.getInt4(0));\n    }\n\n    final int trigger = params.getInt4(0);\n    final int num = params.getInt4(1);\n    final String msg = params.getText(2);\n\n    if (num >= trigger) {\n      throw new TajoInternalError(msg);\n    }\n\n    return DatumFactory.createInt4(params.getInt4(0));\n  }\n}<fim_middle>// class below has no smell\n"}