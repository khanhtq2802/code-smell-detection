{"text": "<fim_prefix>/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\npackage org.apache.fineract.cn.individuallending.internal.service.costcomponent;\n\nimport org.apache.fineract.cn.individuallending.api.v1.domain.workflow.Action;\nimport org.apache.fineract.cn.individuallending.internal.repository.CaseParametersEntity;\nimport org.apache.fineract.cn.individuallending.internal.service.DataContextOfAction;\nimport org.apache.fineract.cn.individuallending.internal.service.schedule.ScheduledAction;\nimport org.apache.fineract.cn.individuallending.internal.service.schedule.ScheduledCharge;\nimport org.apache.fineract.cn.individuallending.internal.service.schedule.ScheduledChargesService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\n\nimport javax.annotation.Nonnull;\nimport javax.annotation.Nullable;\nimport java.math.BigDecimal;\nimport java.time.LocalDate;\nimport java.util.Collections;\nimport java.util.List;\n\n/**\n * @author Myrle Krantz\n */\n<fim_suffix>@Service\npublic class RecoverPaymentBuilderService implements PaymentBuilderService {\n  private final ScheduledChargesService scheduledChargesService;\n\n  @Autowired\n  public RecoverPaymentBuilderService(final ScheduledChargesService scheduledChargesService) {\n    this.scheduledChargesService = scheduledChargesService;\n  }\n\n  @Override\n  public PaymentBuilder getPaymentBuilder(\n      final @Nonnull DataContextOfAction dataContextOfAction,\n      final @Nullable BigDecimal requestedDisbursalSize,\n      final LocalDate forDate,\n      final RunningBalances runningBalances) {\n    final CaseParametersEntity caseParameters = dataContextOfAction.getCaseParametersEntity();\n    final String productIdentifier = dataContextOfAction.getProductEntity().getIdentifier();\n    final int minorCurrencyUnitDigits = dataContextOfAction.getProductEntity().getMinorCurrencyUnitDigits();\n    final List<ScheduledAction> scheduledActions = Collections.singletonList(new ScheduledAction(Action.RECOVER, forDate));\n    final List<ScheduledCharge> scheduledCharges = scheduledChargesService.getScheduledCharges(\n        productIdentifier, scheduledActions);\n\n    final BigDecimal loanPaymentSize = dataContextOfAction.getCaseParametersEntity().getPaymentSize();\n\n    return CostComponentService.getCostComponentsForScheduledCharges(\n        scheduledCharges,\n        caseParameters.getBalanceRangeMaximum(),\n        runningBalances,\n        loanPaymentSize,\n        BigDecimal.ZERO,\n        BigDecimal.ZERO,\n        dataContextOfAction.getInterest(),\n        minorCurrencyUnitDigits,\n        true);\n  }\n}<fim_middle>// class below has no smell\n"}