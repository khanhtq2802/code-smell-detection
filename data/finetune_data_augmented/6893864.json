{"text": "<fim_prefix>/*\nCopyright 2015 Google Inc. All Rights Reserved.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n */\npackage com.google.android.gcm.demo.logic;\n\nimport android.support.v4.util.SimpleArrayMap;\nimport android.util.Log;\n\nimport com.google.android.gcm.demo.service.LoggingService;\n\nimport java.io.BufferedReader;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.InputStreamReader;\nimport java.io.OutputStream;\nimport java.net.HttpURLConnection;\nimport java.net.URL;\n\n\n/**\n * Class representing an HTTP request\n */\n<fim_suffix>public class HttpRequest {\n    public static final String HEADER_CONTENT_TYPE = \"Content-Type\";\n    public static final String HEADER_PROJECT_ID = \"project_id\";\n    public static final String HEADER_AUTHORIZATION = \"Authorization\";\n\n    public static final String CONTENT_TYPE_FORM_ENCODED = \"application/x-www-form-urlencoded\";\n    public static final String CONTENT_TYPE_JSON = \"application/json\";\n\n    private SimpleArrayMap<String, String> mHeaders = new SimpleArrayMap<>();\n    private int responseCode;\n    private String responseBody;\n\n    /**\n     * Add a request header\n     * @param name the header's name\n     * @param value the header's value\n     */\n    public void setHeader(String name, String value) {\n        this.mHeaders.put(name, value);\n    }\n\n    /**\n     * @return this request's response code\n     */\n    public int getResponseCode() {\n        return responseCode;\n    }\n\n    /**\n     *\n     * @return this request's response body\n     */\n    public String getResponseBody() {\n        return responseBody;\n    }\n\n    /**\n     * Post the request\n     * @param url where to post to\n     * @param requestBody the body of the request\n     * @throws IOException\n     */\n    public void doPost(String url, String requestBody) throws IOException {\n        Log.i(LoggingService.LOG_TAG, \"HTTP request. body: \" + requestBody);\n\n        HttpURLConnection conn = (HttpURLConnection) new URL(url).openConnection();\n        conn.setDoOutput(true);\n        conn.setUseCaches(false);\n        conn.setFixedLengthStreamingMode(requestBody.getBytes().length);\n        conn.setRequestMethod(\"POST\");\n        for (int i = 0; i < mHeaders.size(); i++) {\n            conn.setRequestProperty(mHeaders.keyAt(i), mHeaders.valueAt(i));\n        }\n        OutputStream out = null;\n        try {\n            out = conn.getOutputStream();\n            out.write(requestBody.getBytes());\n        } finally {\n            if (out != null) {\n                try {\n                    out.close();\n                } catch (IOException e) {\n                    // Ignore.\n                }\n            }\n        }\n\n        responseCode = conn.getResponseCode();\n\n        InputStream inputStream = null;\n        try {\n            if (responseCode == 200) {\n                inputStream = conn.getInputStream();\n            } else {\n                inputStream = conn.getErrorStream();\n            }\n            responseBody = getString(inputStream);\n        } finally {\n            if (inputStream != null) {\n                try {\n                    inputStream.close();\n                } catch (IOException e) {\n                    // Ignore.\n                }\n            }\n        }\n\n        Log.i(LoggingService.LOG_TAG, \"HTTP response. body: \" + responseBody);\n\n        conn.disconnect();\n    }\n\n    /**\n     * Convenience method to convert an InputStream to a String.\n     * <p/>\n     * If the stream ends in a newline character, it will be stripped.\n     * <p/>\n     * If the stream is {@literal null}, returns an empty string.\n     */\n    private String getString(InputStream stream) throws IOException {\n        if (stream == null) {\n            return \"\";\n        }\n        BufferedReader reader =\n                new BufferedReader(new InputStreamReader(stream));\n        StringBuilder content = new StringBuilder();\n        String newLine;\n        do {\n            newLine = reader.readLine();\n            if (newLine != null) {\n                content.append(newLine).append('\\n');\n            }\n        } while (newLine != null);\n        if (content.length() > 0) {\n            // strip last newline\n            content.setLength(content.length() - 1);\n        }\n        return content.toString();\n    }\n}<fim_middle>// class below has no smell\n"}