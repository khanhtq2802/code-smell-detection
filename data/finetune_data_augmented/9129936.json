{"text": "<fim_prefix>/*******************************************************************************\n * Copyright (c) 2004 Actuate Corporation.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *  Actuate Corporation  - initial API and implementation\n *******************************************************************************/\n\npackage org.eclipse.birt.report.model.command;\n\nimport java.util.Iterator;\nimport java.util.List;\n\nimport org.eclipse.birt.report.model.activity.SimpleRecord;\nimport org.eclipse.birt.report.model.api.activity.NotificationEvent;\nimport org.eclipse.birt.report.model.api.command.CssEvent;\nimport org.eclipse.birt.report.model.core.DesignElement;\nimport org.eclipse.birt.report.model.core.Module;\nimport org.eclipse.birt.report.model.css.CssNameManager;\nimport org.eclipse.birt.report.model.css.CssStyle;\nimport org.eclipse.birt.report.model.css.CssStyleSheet;\nimport org.eclipse.birt.report.model.elements.ICssStyleSheetOperation;\n\n/**\n * \n * Records to add/drop css.\n * \n */\n\npublic class CssRecord extends SimpleRecord\n{\n\n\t/**\n\t * The target module\n\t */\n\n\tprotected Module module;\n\n\t/**\n\t * Design element\n\t */\n\n\tprivate DesignElement element;\n\n\t/**\n\t * The css to operate\n\t */\n\n\tprivate CssStyleSheet css;\n\n\t/**\n\t * Whether to add or remove the css.\n\t */\n\n\tprivate boolean add = true;\n\n\t/**\n\t * Position of css file\n\t */\n\n\tprivate int position = -1;\n\n\t/**\n\t * Constructors the css record.\n\t * \n\t * @param module\n\t *            the module\n\t * @param element\n\t *            design element\n\t * @param css\n\t *            the css style sheet to add/drop\n\t * @param add\n\t *            whether the given css is for adding\n\t */\n\n\tCssRecord( Module module, DesignElement element, CssStyleSheet css,\n\t\t\tboolean add )\n\t{\n\t\tthis.module = module;\n\t\tthis.element = element;\n\t\tthis.css = css;\n\t\tthis.add = add;\n\t}\n\n\t/**\n\t * Constructors the css record.\n\t * \n\t * @param module\n\t * @param element\n\t * @param css\n\t * @param add\n\t * @param pos\n\t */\n\n<fim_suffix>\tCssRecord( Module module, DesignElement element, CssStyleSheet css,\n\t\t\tboolean add, int pos )\n\t{\n\t\tthis.module = module;\n\t\tthis.element = element;\n\t\tthis.css = css;\n\t\tthis.add = add;\n\t\tthis.position = pos;\n\t}\n\n\t/*\n\t * (non-Javadoc)\n\t * \n\t * @see org.eclipse.birt.report.model.activity.SimpleRecord#perform(boolean)\n\t */\n\n\tprotected void perform( boolean undo )\n\t{\n\t\tassert element instanceof ICssStyleSheetOperation;\n\n\t\tICssStyleSheetOperation operation = (ICssStyleSheetOperation) element;\n\t\tif ( add && !undo || !add && undo )\n\t\t{\n\t\t\tif ( position == -1 )\n\t\t\t{\n\t\t\t\toperation.addCss( css );\n\t\t\t\tsetContainer( element, css );\n\t\t\t\tint size = operation.getCsses( ).size( );\n\n\t\t\t\t// re-resolve\n\t\t\t\tCssNameManager.adjustStylesForAdd( module, operation, css,\n\t\t\t\t\t\tsize - 1 );\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// insert css into position\n\n\t\t\t\toperation.insertCss( css, position );\n\t\t\t\tsetContainer( element, css );\n\t\t\t\t// re-resolve\n\t\t\t\tCssNameManager.adjustStylesForAdd( module, operation, css,\n\t\t\t\t\t\tposition );\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\toperation.dropCss( css );\n\t\t\tsetContainer( null, css );\n\t\t\t// unresolve\n\t\t\tCssNameManager.adjustStylesForRemove( css );\n\t\t}\n\t}\n\n\t/**\n\t * Sets container of CssStyleSheet. container must be report design / theme.\n\t * \n\t * @param element\n\t * @param sheet\n\t */\n\n\tprivate void setContainer( DesignElement element, CssStyleSheet sheet )\n\t{\n\t\tif ( sheet == null )\n\t\t\treturn;\n\t\tsheet.setContainer( element );\n\t\tList<CssStyle> styles = sheet.getStyles( );\n\t\tIterator<CssStyle> iter = styles.iterator( );\n\t\twhile ( iter.hasNext( ) )\n\t\t{\n\t\t\tCssStyle style = iter.next( );\n\t\t\tstyle.setCssStyleSheet( sheet );\n\t\t}\n\t}\n\n\t/*\n\t * (non-Javadoc)\n\t * \n\t * @see\n\t * org.eclipse.birt.report.model.activity.AbstractElementRecord#getEvent()\n\t */\n\n\tpublic NotificationEvent getEvent( )\n\t{\n\t\tif ( add && state != UNDONE_STATE || !add && state == UNDONE_STATE )\n\t\t\treturn new CssEvent( css, CssEvent.ADD );\n\n\t\treturn new CssEvent( css, CssEvent.DROP );\n\t}\n\n\t/*\n\t * (non-Javadoc)\n\t * \n\t * @see\n\t * org.eclipse.birt.report.model.activity.AbstractElementRecord#getTarget()\n\t */\n\n\tpublic DesignElement getTarget( )\n\t{\n\t\treturn element;\n\t}\n}<fim_middle>// function below has no smell\n"}