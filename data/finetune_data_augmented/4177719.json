{"text": "<fim_prefix>/*****************************************************************\n *   Licensed to the Apache Software Foundation (ASF) under one\n *  or more contributor license agreements.  See the NOTICE file\n *  distributed with this work for additional information\n *  regarding copyright ownership.  The ASF licenses this file\n *  to you under the Apache License, Version 2.0 (the\n *  \"License\"); you may not use this file except in compliance\n *  with the License.  You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing,\n *  software distributed under the License is distributed on an\n *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n *  KIND, either express or implied.  See the License for the\n *  specific language governing permissions and limitations\n *  under the License.\n ****************************************************************/\n\npackage org.apache.cayenne.dbsync.merge.factory;\n\nimport org.apache.cayenne.dba.DbAdapter;\nimport org.apache.cayenne.dba.QuotingStrategy;\nimport org.apache.cayenne.dbsync.merge.token.MergerToken;\nimport org.apache.cayenne.dbsync.merge.token.db.SetAllowNullToDb;\nimport org.apache.cayenne.dbsync.merge.token.db.SetColumnTypeToDb;\nimport org.apache.cayenne.dbsync.merge.token.db.SetGeneratedFlagToDb;\nimport org.apache.cayenne.dbsync.merge.token.db.SetPrimaryKeyToDb;\nimport org.apache.cayenne.map.DbAttribute;\nimport org.apache.cayenne.map.DbEntity;\n\nimport java.util.Collection;\nimport java.util.Collections;\nimport java.util.List;\n\n/**\n * @since 3.0\n */\n<fim_suffix>public class H2MergerTokenFactory extends DefaultMergerTokenFactory {\n\n    @Override\n    public MergerToken createSetColumnTypeToDb(final DbEntity entity, DbAttribute columnOriginal,\n            final DbAttribute columnNew) {\n        return new SetColumnTypeToDb(entity, columnOriginal, columnNew) {\n\n            @Override\n            protected void appendPrefix(StringBuffer sqlBuffer, QuotingStrategy context) {\n                sqlBuffer.append(\"ALTER TABLE \");\n                sqlBuffer.append(context.quotedFullyQualifiedName(entity));\n                sqlBuffer.append(\" ALTER \");\n                sqlBuffer.append(context.quotedName(columnNew));\n                sqlBuffer.append(\" \");\n            }\n        };\n    }\n\n    @Override\n    public MergerToken createSetAllowNullToDb(DbEntity entity, DbAttribute column) {\n        return new SetAllowNullToDb(entity, column) {\n\n            @Override\n            public List<String> createSql(DbAdapter adapter) {\n                return Collections.singletonList(\"ALTER TABLE \" + getEntity().getFullyQualifiedName()\n                        + \" ALTER COLUMN \" + getColumn().getName() + \" SET NULL\");\n            }\n\n        };\n    }\n\n    @Override\n    public MergerToken createSetPrimaryKeyToDb(DbEntity entity, Collection<DbAttribute> primaryKeyOriginal,\n            Collection<DbAttribute> primaryKeyNew, String detectedPrimaryKeyName) {\n        return new SetPrimaryKeyToDb(entity, primaryKeyOriginal, primaryKeyNew, detectedPrimaryKeyName) {\n\n            @Override\n            protected void appendDropOriginalPrimaryKeySQL(DbAdapter adapter, List<String> sqls) {\n                sqls.add(\"ALTER TABLE \" + adapter.getQuotingStrategy().quotedFullyQualifiedName(getEntity())\n                        + \" DROP PRIMARY KEY\");\n            }\n\n        };\n    }\n\n    @Override\n    public MergerToken createSetGeneratedFlagToDb(DbEntity entity, DbAttribute column, boolean isGenerated) {\n        return new SetGeneratedFlagToDb(entity, column, isGenerated) {\n            protected void appendAlterColumnClause(DbAdapter adapter, StringBuffer builder) {\n                builder.append(\" ALTER COLUMN \");\n            }\n\n            @Override\n            protected void appendAutoIncrement(DbAdapter adapter, StringBuffer builder) {\n                adapter.createTableAppendColumn(builder, this.getColumn());\n            }\n\n            @Override\n            protected void appendDropAutoIncrement(DbAdapter adapter, StringBuffer builder) {\n                throw new UnsupportedOperationException(\"Can't automatically drop AUTO_INCREMENT in H2 database. You should do this manually.\");\n            }\n\n            @Override\n            public boolean isEmpty() {\n                return false;\n            }\n        };\n    }\n}<fim_middle>// class below has no smell\n"}