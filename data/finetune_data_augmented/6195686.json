{"text": "<fim_prefix>/*\n * Copyright (c) 2012-2018 Red Hat, Inc.\n * This program and the accompanying materials are made\n * available under the terms of the Eclipse Public License 2.0\n * which is available at https://www.eclipse.org/legal/epl-2.0/\n *\n * SPDX-License-Identifier: EPL-2.0\n *\n * Contributors:\n *   Red Hat, Inc. - initial API and implementation\n */\npackage org.eclipse.che.ide.upload.file;\n\nimport com.google.gwt.uibinder.client.UiBinder;\nimport com.google.gwt.uibinder.client.UiField;\nimport com.google.gwt.user.client.ui.Button;\nimport com.google.gwt.user.client.ui.CheckBox;\nimport com.google.gwt.user.client.ui.FileUpload;\nimport com.google.gwt.user.client.ui.FlowPanel;\nimport com.google.gwt.user.client.ui.FormPanel;\nimport com.google.gwt.user.client.ui.Widget;\nimport com.google.inject.Inject;\nimport javax.validation.constraints.NotNull;\nimport org.eclipse.che.ide.CoreLocalizationConstant;\nimport org.eclipse.che.ide.core.AgentURLModifier;\nimport org.eclipse.che.ide.ui.window.Window;\n\n/**\n * The implementation of {@link UploadFileView}.\n *\n * @author Roman Nikitenko.\n */\n<fim_suffix>public class UploadFileViewImpl extends Window implements UploadFileView {\n\n  public interface UploadFileViewBinder extends UiBinder<Widget, UploadFileViewImpl> {}\n\n  private final AgentURLModifier agentURLModifier;\n\n  Button btnCancel;\n  Button btnUpload;\n\n  @UiField FormPanel submitForm;\n  @UiField CheckBox overwrite;\n  @UiField FlowPanel uploadPanel;\n\n  FileUpload file;\n  ActionDelegate delegate;\n\n  /** Create view. */\n  @Inject\n  public UploadFileViewImpl(\n      UploadFileViewBinder uploadFileViewBinder,\n      CoreLocalizationConstant locale,\n      AgentURLModifier agentURLModifier) {\n\n    this.setTitle(locale.uploadFileTitle());\n    setWidget(uploadFileViewBinder.createAndBindUi(this));\n    bind();\n\n    btnCancel =\n        addFooterButton(\n            locale.cancel(), \"file-uploadFile-cancel\", event -> delegate.onCancelClicked());\n\n    btnUpload =\n        addFooterButton(\n            locale.uploadButton(),\n            \"file-uploadFile-upload\",\n            event -> delegate.onUploadClicked(),\n            true);\n    this.agentURLModifier = agentURLModifier;\n  }\n\n  /** Bind handlers. */\n  private void bind() {\n    submitForm.addSubmitCompleteHandler(event -> delegate.onSubmitComplete(event.getResults()));\n  }\n\n  /** {@inheritDoc} */\n  @Override\n  public void showDialog() {\n    show();\n  }\n\n  @Override\n  protected void onShow() {\n    addFile();\n  }\n\n  /** {@inheritDoc} */\n  @Override\n  public void closeDialog() {\n    hide();\n  }\n\n  @Override\n  protected void onHide() {\n    btnUpload.setEnabled(false);\n    overwrite.setValue(false);\n    uploadPanel.remove(file);\n  }\n\n  /** {@inheritDoc} */\n  @Override\n  public void setDelegate(ActionDelegate delegate) {\n    this.delegate = delegate;\n  }\n\n  /** {@inheritDoc} */\n  @Override\n  public void setEnabledUploadButton(boolean enabled) {\n    btnUpload.setEnabled(enabled);\n  }\n\n  /** {@inheritDoc} */\n  @Override\n  public void setEncoding(@NotNull String encodingType) {\n    submitForm.setEncoding(encodingType);\n  }\n\n  /** {@inheritDoc} */\n  @Override\n  public void setAction(@NotNull String url) {\n    submitForm.setAction(agentURLModifier.modify(url));\n    submitForm.setMethod(FormPanel.METHOD_POST);\n  }\n\n  /** {@inheritDoc} */\n  @Override\n  public void submit() {\n    overwrite.setFormValue(overwrite.getValue().toString());\n    submitForm.submit();\n    btnUpload.setEnabled(false);\n  }\n\n  /** {@inheritDoc} */\n  @Override\n  @NotNull\n  public String getFileName() {\n    String fileName = file.getFilename();\n    if (fileName.contains(\"/\")) {\n      return fileName.substring(fileName.lastIndexOf(\"/\") + 1);\n    }\n    if (fileName.contains(\"\\\\\")) {\n      return fileName.substring(fileName.lastIndexOf(\"\\\\\") + 1);\n    }\n    return fileName;\n  }\n\n  /** {@inheritDoc} */\n  @Override\n  public boolean isOverwriteFileSelected() {\n    return overwrite.getValue();\n  }\n\n  private void addFile() {\n    file = new FileUpload();\n    file.setHeight(\"22px\");\n    file.setWidth(\"100%\");\n    file.setName(\"file\");\n    file.ensureDebugId(\"file-uploadFile-ChooseFile\");\n    file.addChangeHandler(event -> delegate.onFileNameChanged());\n    uploadPanel.insert(file, 0);\n  }\n}<fim_middle>// class below is blob\n"}